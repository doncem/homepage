window.artists=null;window.songs=null;var GAP=10;var backspace=function(){var a=$("#search-q").val().split("");if(a.length>0){a.pop();$("#search-q").val(a.join(""))}};var shift=function(){var b=["Q","W","E","R","T","Y","U","I","O","P"];var a=$("#shift").html()==="ABC";$("#input-1 .letter").each(function(c,d){if(a){$(d).html(b[c])}else{$(d).html(c)}});if(a){$("#shift").html("1-2-3")}else{$("#shift").html("ABC")}};var space=function(){var a=$("#search-q").val().split("");a.push(" ");$("#search-q").val(a.join(""))};var resizeMe=function(){var a=$(window).width();var c=$(window).height();var b=$("#results-container > ul").height();$("#page").width(a);$("#page").height(c-b-GAP);$("#history").height(c);$("#keyboard").width(a);$("#results").css({marginTop:b+GAP});$("#results").height(c-b-GAP)};var initData=function(){(function(a,b){if(typeof define==="function"&&define.amd){define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)})}else{b(_,Backbone)}}(this,function(b,f){b.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var d=f.Model.extend({idAttribute:"_id",name:"name"});var e=f.Collection.extend({model:d});window.artists=new e();window.artists.add(data.artists);var c=f.Model.extend({idAttribute:"_id",artist_id:"artist_id",name:"name",filename:"filename",counter:"counter"});var a=f.Collection.extend({model:c});window.songs=new a();window.songs.add(data.songs);window.Row=f.View.extend({el:"#results",template:b.template($("#search-result-row").html()),className:"search-result-row found",artist:null,initialize:function(g){this.model=g.model;this.id=g.id;this.artist=window.artists.findWhere({_id:this.model.get("artist_id")});this.render()},render:function(){this.$el.append(this.template({el_id:this.id,el_class:this.className,song_id:this.model.get("_id"),song:this.model.get("name"),artist:this.artist.get("name")}))}})}))};var doSearch=function(){if($("#search-q").val().length>0){r=_.filter(window.songs.models,function(a){return a.get("name").toLowerCase().indexOf($("#search-q").val().toLowerCase())!==-1});_.each(r,function(c,b,a){if($("#search-result-row-"+c.get("_id")).length===0){var d=new window.Row({model:c,id:"search-result-row-"+c.get("_id")})}else{$("#search-result-row-"+c.get("_id")).addClass("found")}});$(".search-result-row").each(function(a,b){if($(b).hasClass("found")){$(b).removeClass("found").fadeIn("fast")}else{$(b).fadeOut("slow")}})}};var doFilter=function(d){if(d===""){$(".search-result-row").each(function(f,g){$(g).fadeIn("fast")})}else{var a=d.split("-");var c=false;switch(a[1]){case"artists":c=1;break;case"songs":c=0;break}if(c!==false){var b=$("#search-q").val();$(".search-result-row").filter(function(e){var f=$(this).children("li").filter(function(g){return g===c}).html().toLowerCase().indexOf(b.toLowerCase());if(f===-1){return true}else{$(this).fadeIn("fast");return false}}).each(function(f,g){$(g).fadeOut("slow")})}}};$(function(){var a=false;$.getJSON("/jukebox/get-songs",function(d){if(d.error!==undefined){$("#results").html("unable to load songs library: "+d.error);return}data=d.data;initData();a=true}).error(function(){a=false;$("#results").html("something went wrong on server side - we can't search for songs :(")});resizeMe();$(window).resize(function(){resizeMe()});var c="";$("#results-container > ul button[disabled!='disabled']").click(function(){if(c!==""&&c!==$(this).attr("id")){$("#"+c).toggleClass("active")}$(this).toggleClass("active");c=$(this).hasClass("active")?$(this).attr("id"):"";doFilter(c)});$("#search-clear").click(function(){$("#search-q").val("")});$("#search-container").on("focus","input",function(){if($("#keyboard-container").is(":hidden")){$("#keyboard-container").slideDown("slow")}});$(window).click(function(){if($("#search-container input:focus,#keyboard button:focus").length===0){$("#keyboard-container").slideUp("slow")}});$("#results-container").on("scroll","#results",function(){$("#keyboard-container").slideUp("slow")});var b=false;$("#keyboard button").click(function(){var d=$(this).attr("id");if((d!==undefined)&&(d!==false)&&(d!=="search-clear")){window[d]()}else{if(d!=="search-clear"){$("#search-q").val($("#search-q").val()+$(this).html())}}if($("#search-q").val().length>2){if(a){if((b!==undefined)&&(b!==false)){clearTimeout(b)}b=setTimeout("doSearch()",500)}}});$(".test").draggable({opacity:0.7,revert:"invalid",stack:"#results > ul"});$("#history").droppable({accept:"#results > ul",hoverClass:"history-hovered",drop:function(f,d){d.draggable.draggable("disable");$(this).append(d.draggable);d.draggable.removeAttr("style");$.post("/jukebox-gearman/",{action:"set-queue",q:d.draggable.data("song-id")})}})});