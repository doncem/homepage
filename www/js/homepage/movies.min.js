function zeroPad(a,b){var c=a+"";while(c.length<b){c="0"+c}return c}var colours=[3,2,4];function drawPlot(a,b){source=[];for(i in b.graphs){source.push({data:b.graphs[i].data,label:b.graphs[i].label,yaxis:b.graphs[i].y,bars:{show:b.graphs[i].bars},lines:{show:b.graphs[i].lines},color:colours[i]})}$.plot($("#"+a),source,{legend:{position:b.legend.position,backgroundOpacity:0.6},grid:{clickable:b.grid.clickable,hoverable:true},xaxis:{tickSize:1,ticks:b.x.data,labelAngle:b.x.angle},yaxes:[{ticks:10},{alignTicksWithAxis:b.y.align,position:b.y.position}]})}function showTooltip(a,f,d,e,b){$('<div id="tooltip">'+(b?d.toFixed(3):d)+"</div>").css({top:f-30,left:a,backgroundColor:e,borderColor:e}).appendTo("body").fadeIn(200)}function formatStringForID(a){return a.replace(/[^a-zA-Z 0-9]+/g,"")}function checkJqxhr(b,a){if(typeof b==="object"){b.done(function(){if(a!==undefined){$("#"+a).show()}}).fail(function(){$("#page-content .wrapper").append('<div class="error ajax-movies-data">Something went wrong here :( - couldn\'t get what you requested</div>')}).always(function(){$("#spinning-squares").addClass("hidden").removeAttr("id")})}}function wrongParamsInRouter(a){$("#page-content .wrapper").append('<div class="error ajax-movies-data">Something went wrong here :( - couldn\'t get what you requested. We have an error saying: '+a+"</div>")}$(function(){var e;var c;var a=Backbone.Router.extend({routes:{"by-year/:year":"moviesYear","by-genre/:genre":"moviesGenre","by-director-count/:directors":"moviesDirectors","by-country/:country/:type":"moviesCountry"},moviesYear:function(f){c=formatStringForID(f);if($("#p_year_"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#p_year_"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");e=$.getJSON("/ajax-movies-by-year/"+f,function(h){if(h.error!==undefined){wrongParamsInRouter(h.error);return}var j=$("<ul />").attr("id","p_year_"+c).addClass("ajax-movies-data");$.each(h.movies,function(k,l){j.append($("<li />").append($("<a />").attr({href:l.link,target:"_blank"}).html(l.title+(l.title_en!==null?" ("+l.title_en+")":""))).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(h.genres[k],function(m,n){return m.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(h.countries[k],function(n,m){return n.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(h.directors[k],function(m,n){return m.director}).join(", ")))))});$("#page-content .wrapper").append(j)});checkJqxhr(e)}},moviesGenre:function(f){c=formatStringForID(f);if($("#p_genre_"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#p_genre_"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");e=$.getJSON("/ajax-movies-and-series-by-genre/"+f,function(h){if(h.error!==undefined){wrongParamsInRouter(h.error);return}var j=$("<ul />").attr("id","p_genre_"+c).addClass("ajax-movies-data").append($("<li />").html("<strong>MOVIES:</strong>"));$.each(h.movies,function(k,l){j.append($("<li />").append($("<a />").attr({href:l.link,target:"_blank"}).html(l.title+(l.title_en!==null?" ("+l.title_en+")":"")+" ["+l.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(h.genres[k],function(m,n){return m.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(h.countries[k],function(n,m){return n.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(h.directors[k],function(m,n){return m.director}).join(", ")))))});j.append($("<li />").html("<strong>SERIES:</strong>"));$.each(h.series,function(k,l){j.append($("<li />").append($("<a />").attr({href:l.link,target:"_blank"}).html(l.title+(l.title_en!==null?" ("+l.title_en+")":"")+" ["+l.year_from+" - "+l.year_until+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(h.series_genres[k],function(m,n){return m.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(h.series_countries[k],function(n,m){return n.country}).join(", ")))))});$("#page-content .wrapper").append(j)});checkJqxhr(e)}},moviesDirectors:function(f){c=formatStringForID(f);if($("#p_directed_"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#p_directed_"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");e=$.getJSON("/ajax-movies-by-director-count/"+f,function(h){if(h.error!==undefined){wrongParamsInRouter(h.error);return}var j=$("<ul />").attr("id","p_directed_"+c).addClass("ajax-movies-data");$.each(h.directors,function(k,l){j.append($("<li />").html("<strong>"+l.director+"</strong>").append($("<ul />").append($.map(h["movies_"+k],function(m,n){return $("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":"")+" ["+m.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(h["genres_"+k][n],function(o,p){return o.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(h["countries_"+k][n],function(p,o){return p.country}).join(", "))).append((h["directors_"+k][n].length>1?$("<li />").html("<strong>Other directors: </strong>"+$.map(h["directors_"+k][n],function(o,p){return o.director!==l.director?o.director:""}).clean().join(", ")):""))).html()}).join())))});$("#page-content .wrapper").append(j)});checkJqxhr(e)}},moviesCountry:function(h,f){c=formatStringForID(h);if($("#p_"+f+"_"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#p_"+f+"_"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");e=$.getJSON("/ajax-movies-and-series-by-country/"+h,function(j){if(j.error!==undefined){wrongParamsInRouter(j.error);return}var k=$("<ul />").attr("id","p_movies_"+c).addClass("ajax-movies-data hidden");$.each(j.movies,function(l,m){k.append($("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":"")+" ["+m.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(j.genres[l],function(n,o){return n.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(j.countries[l],function(o,n){return o.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(j.directors[l],function(n,o){return n.director}).join(", ")))))});$("#page-content .wrapper").append(k);k=$("<ul />").attr("id","p_series_"+c).addClass("ajax-movies-data hidden");$.each(j.series,function(l,m){k.append($("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":"")+" ["+m.year_from+" - "+m.year_until+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(j.series_genres[l],function(n,o){return n.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(j.series_countries[l],function(o,n){return o.country}).join(", ")))))});$("#page-content .wrapper").append(k)});checkJqxhr(e,"p_"+f+"_"+c)}}});new a();Backbone.history.start({silent:true});g={p_year:{grid:{clickable:true},graphs:[{data:d_y,label:"movies ("+Math.ceil(d_y_m[0][1]*d_y_x.length)+")",bars:true,lines:false,y:1},{data:d_y_m,label:"mean",bars:false,lines:true,y:1},{data:d_y_s,label:"standard deviation",bars:false,lines:true,y:1}],legend:{position:"nw"},x:{data:d_y_x,angle:270},y:{align:null,position:"left"}},p_decade:{grid:{clickable:false},graphs:[{data:d_yd,label:"movies",bars:true,lines:false,y:1},{data:d_yd_m,label:"mean",bars:false,lines:true,y:1},{data:d_yd_s,label:"standard deviation",bars:false,lines:true,y:1}],legend:{position:"nw"},x:{data:d_yd_x,angle:0},y:{align:null,position:"left"}},p_genre:{grid:{clickable:true},graphs:[{data:d_g_m,label:"movies",bars:true,lines:false,y:1},{data:d_g_s,label:"tv shows",bars:true,lines:false,y:1},{data:d_g_c,label:"correlation",bars:false,lines:true,y:2}],legend:{position:"nw"},x:{data:d_g_x,angle:270},y:{align:1,position:"right"}},p_directed:{grid:{clickable:true},graphs:[{data:d_d,label:"#movies by directors",bars:true,lines:false,y:1}],legend:{position:"ne"},x:{data:d_d_x,angle:0},y:{align:null,position:"left"}}};for(i in g){drawPlot(i,g[i])}var b=null;var d=null;$(".placeholder").bind("plothover",function(h,j,f){if(f){$(this).css("cursor","pointer");if((b!==f.dataIndex)||(d!==f.series.label)){b=f.dataIndex;d=f.series.label;$("#tooltip").remove();showTooltip(f.pageX,f.pageY,f.datapoint[1],f.series.color,!(($(this).attr("id")==="p_year")||($(this).attr("id")==="p_decade")||(f.series.label==="correlation")))}}else{$(this).css("cursor","default");$("#tooltip").remove();b=null}});$(".placeholder").bind("plotclick",function(j,k,h){if(h){if(h.series.bars.show){var f=encodeURI(h.series.xaxis.ticks[h.dataIndex].label);switch(j.currentTarget.id){case"p_year":window.location.hash="#by-year/"+f;break;case"p_genre":window.location.hash="#by-genre/"+f;break;case"p_directed":window.location.hash="#by-director-count/"+f;break;default:alert("Nothing's available here :/");break}}}})});