function zeroPad(a,b){var c=a+"";while(c.length<b){c="0"+c}return c}var colours=[3,2,4];function drawPlot(a,b){source=[];for(i in b.graphs){source.push({data:b.graphs[i].data,label:b.graphs[i].label,yaxis:b.graphs[i].y,bars:{show:b.graphs[i].bars},lines:{show:b.graphs[i].lines},color:colours[i]})}$.plot($("#"+a),source,{legend:{position:b.legend.position,backgroundOpacity:0.6},grid:{clickable:b.grid.clickable,hoverable:true},xaxis:{tickSize:1,ticks:b.x.data,labelAngle:b.x.angle},yaxes:[{ticks:10},{alignTicksWithAxis:b.y.align,position:b.y.position}]})}function showTooltip(a,f,d,e,b){$('<div id="tooltip">'+(b?d.toFixed(3):d)+"</div>").css({top:f-30,left:a,backgroundColor:e,borderColor:e}).appendTo("body").fadeIn(200)}$(function(){g={p_year:{grid:{clickable:true},graphs:[{data:d_y,label:"movies ("+Math.ceil(d_y_m[0][1]*d_y_x.length)+")",bars:true,lines:false,y:1},{data:d_y_m,label:"mean",bars:false,lines:true,y:1},{data:d_y_s,label:"standard deviation",bars:false,lines:true,y:1}],legend:{position:"nw"},x:{data:d_y_x,angle:270},y:{align:null,position:"left"}},p_decade:{grid:{clickable:false},graphs:[{data:d_yd,label:"movies",bars:true,lines:false,y:1},{data:d_yd_m,label:"mean",bars:false,lines:true,y:1},{data:d_yd_s,label:"standard deviation",bars:false,lines:true,y:1}],legend:{position:"nw"},x:{data:d_yd_x,angle:0},y:{align:null,position:"left"}},p_genre:{grid:{clickable:true},graphs:[{data:d_g_m,label:"movies",bars:true,lines:false,y:1},{data:d_g_s,label:"tv shows",bars:true,lines:false,y:1},{data:d_g_c,label:"correlation",bars:false,lines:true,y:2}],legend:{position:"nw"},x:{data:d_g_x,angle:270},y:{align:1,position:"right"}},p_directed:{grid:{clickable:true},graphs:[{data:d_d,label:"#movies by directors",bars:true,lines:false,y:1}],legend:{position:"ne"},x:{data:d_d_x,angle:0},y:{align:null,position:"left"}}};for(i in g){drawPlot(i,g[i])}var a=null;var b=null;$(".placeholder").bind("plothover",function(d,e,c){if(c){$(this).css("cursor","pointer");if((a!==c.dataIndex)||(b!==c.series.label)){a=c.dataIndex;b=c.series.label;$("#tooltip").remove();showTooltip(c.pageX,c.pageY,c.datapoint[1],c.series.color,!(($(this).attr("id")==="p_year")||($(this).attr("id")==="p_decade")||(c.series.label==="correlation")))}}else{$(this).css("cursor","default");$("#tooltip").remove();a=null}});$(".placeholder").bind("plotclick",function(f,j,e){if(e){if(e.series.bars.show){var c="";var d="";var h="";switch(f.currentTarget.id){case"p_year":c="p_year_"+e.series.xaxis.ticks[e.dataIndex].label;if($("#"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");h=$.getJSON("/ajax-movies-by-year/"+encodeURI(e.series.xaxis.ticks[e.dataIndex].label),function(k){d=$("<ul />").attr("id",c).addClass("ajax-movies-data");$.each(k.movies,function(l,m){d.append($("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":""))).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(k.genres[l],function(n,o){return n.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(k.countries[l],function(o,n){return o.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(k.directors[l],function(n,o){return n.director}).join(", ")))))});$("#page-content .wrapper").append(d)})}break;case"p_genre":c="p_genre_"+e.series.xaxis.ticks[e.dataIndex].label;if($("#"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");h=$.getJSON("/ajax-movies-and-series-by-genre/"+encodeURI(e.series.xaxis.ticks[e.dataIndex].label),function(k){d=$("<ul />").attr("id",c).addClass("ajax-movies-data").append($("<li />").html("<strong>MOVIES:</strong>"));$.each(k.movies,function(l,m){d.append($("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":"")+" ["+m.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(k.genres[l],function(n,o){return n.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(k.countries[l],function(o,n){return o.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(k.directors[l],function(n,o){return n.director}).join(", ")))))});d.append($("<li />").html("<strong>SERIES:</strong>"));$.each(k.series,function(l,m){d.append($("<li />").append($("<a />").attr({href:m.link,target:"_blank"}).html(m.title+(m.title_en!==null?" ("+m.title_en+")":"")+" ["+m.year_from+" - "+m.year_until+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(k.series_genres[l],function(n,o){return n.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(k.series_countries[l],function(o,n){return o.country}).join(", ")))))});$("#page-content .wrapper").append(d)})}break;case"p_directed":c="p_directed_"+e.series.xaxis.ticks[e.dataIndex].label;if($("#"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");h=$.getJSON("/ajax-movies-by-director-count/"+encodeURI(e.series.xaxis.ticks[e.dataIndex].label),function(k){d=$("<ul />").attr("id",c).addClass("ajax-movies-data");$.each(k.directors,function(l,m){d.append($("<li />").html("<strong>"+m.director+"</strong>").append($("<ul />").append($.map(k["movies_"+l],function(n,o){return $("<li />").append($("<a />").attr({href:n.link,target:"_blank"}).html(n.title+(n.title_en!==null?" ("+n.title_en+")":"")+" ["+n.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(k["genres_"+l][o],function(p,q){return p.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(k["countries_"+l][o],function(q,p){return q.country}).join(", "))).append((k["directors_"+l][o].length>1?$("<li />").html("<strong>Other directors: </strong>"+$.map(k["directors_"+l][o],function(p,q){return p.director!==m.director?p.director:""}).clean().join(", ")):""))).html()}).join())))});$("#page-content .wrapper").append(d)})}break;default:alert("Nothing available here :/");break}if(typeof h==="object"){h.error(function(){$("#page-content .wrapper").append('<div class="error">Something went wrong here :( - couldn\'t get what you requested</div>')}).complete(function(){$("#spinning-squares").addClass("hidden").removeAttr("id")})}}}});$("#movies a,#series a").click(function(f){f.preventDefault();var d=$(this);var c="p_"+d.parents("div").attr("id")+"_"+d.html().replace(" ","_");if($("#"+c).length>0){$("#page-content .wrapper").sizeWrapper().show("fast");$("#"+c).show()}else{$("#page-content .wrapper").sizeWrapper().show("fast").children(".loading").removeClass("hidden").attr("id","spinning-squares");$.getJSON(d.attr("href"),function(e){var h=$("<ul />").attr("id","p_movies_"+d.html().replace(" ","_")).addClass("ajax-movies-data"+(d.parents("div").attr("id")==="movies"?"":" hidden"));$.each(e.movies,function(j,k){h.append($("<li />").append($("<a />").attr({href:k.link,target:"_blank"}).html(k.title+(k.title_en!==null?" ("+k.title_en+")":"")+" ["+k.year+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(e.genres[j],function(l,m){return l.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(e.countries[j],function(m,l){return m.country}).join(", "))).append($("<li />").html("<strong>Directors: </strong>"+$.map(e.directors[j],function(l,m){return l.director}).join(", ")))))});$("#page-content .wrapper").append(h);h=$("<ul />").attr("id","p_series_"+d.html().replace(" ","_")).addClass("ajax-movies-data"+(d.parents("div").attr("id")==="series"?"":" hidden"));$.each(e.series,function(j,k){h.append($("<li />").append($("<a />").attr({href:k.link,target:"_blank"}).html(k.title+(k.title_en!==null?" ("+k.title_en+")":"")+" ["+k.year_from+" - "+k.year_until+"]")).append($("<ul />").append($("<li />").html("<strong>Genres: </strong>"+$.map(e.series_genres[j],function(l,m){return l.genre}).join(", "))).append($("<li />").html("<strong>Countries: </strong>"+$.map(e.series_countries[j],function(m,l){return m.country}).join(", ")))))});$("#page-content .wrapper").append(h)})}})});