(function(){var u=this;var B=u.Backbone;var g=[];var D=g.push;var n=g.slice;var t=g.splice;var z;if(typeof exports!=="undefined"){z=exports}else{z=u.Backbone={}}z.VERSION="1.0.0";var K=u._;if(!K&&(typeof require!=="undefined")){K=require("underscore")}z.$=u.jQuery||u.Zepto||u.ender||u.$;z.noConflict=function(){u.Backbone=B;return this};z.emulateHTTP=false;z.emulateJSON=false;var I=z.Events={on:function(L,O,N){if(!x(this,"on",L,[O,N])||!O){return this}this._events||(this._events={});var M=this._events[L]||(this._events[L]=[]);M.push({callback:O,context:N,ctx:N||this});return this},once:function(M,P,N){if(!x(this,"once",M,[P,N])||!P){return this}var L=this;var O=K.once(function(){L.off(M,O);P.apply(this,arguments)});O._callback=P;return this.on(M,O,N)},off:function(L,U,M){var S,T,V,R,Q,N,P,O;if(!this._events||!x(this,"off",L,[U,M])){return this}if(!L&&!U&&!M){this._events={};return this}R=L?[L]:K.keys(this._events);for(Q=0,N=R.length;Q<N;Q++){L=R[Q];if(V=this._events[L]){this._events[L]=S=[];if(U||M){for(P=0,O=V.length;P<O;P++){T=V[P];if((U&&U!==T.callback&&U!==T.callback._callback)||(M&&M!==T.context)){S.push(T)}}}if(!S.length){delete this._events[L]}}}return this},trigger:function(N){if(!this._events){return this}var M=n.call(arguments,1);if(!x(this,"trigger",N,M)){return this}var O=this._events[N];var L=this._events.all;if(O){b(O,M)}if(L){b(L,arguments)}return this},stopListening:function(O,L,Q){var M=this._listeners;if(!M){return this}var N=!L&&!Q;if(typeof L==="object"){Q=this}if(O){(M={})[O._listenerId]=O}for(var P in M){M[P].off(L,Q,this);if(N){delete this._listeners[P]}}return this}};var w=/\s+/;var x=function(S,Q,M,P){if(!M){return true}if(typeof M==="object"){for(var O in M){S[Q].apply(S,[O,M[O]].concat(P))}return false}if(w.test(M)){var R=M.split(w);for(var N=0,L=R.length;N<L;N++){S[Q].apply(S,[R[N]].concat(P))}return false}return true};var b=function(Q,O){var R,P=-1,N=Q.length,M=O[0],L=O[1],S=O[2];switch(O.length){case 0:while(++P<N){(R=Q[P]).callback.call(R.ctx)}return;case 1:while(++P<N){(R=Q[P]).callback.call(R.ctx,M)}return;case 2:while(++P<N){(R=Q[P]).callback.call(R.ctx,M,L)}return;case 3:while(++P<N){(R=Q[P]).callback.call(R.ctx,M,L,S)}return;default:while(++P<N){(R=Q[P]).callback.apply(R.ctx,O)}}};var C={listenTo:"on",listenToOnce:"once"};K.each(C,function(L,M){I[M]=function(P,N,R){var O=this._listeners||(this._listeners={});var Q=P._listenerId||(P._listenerId=K.uniqueId("l"));O[Q]=P;if(typeof N==="object"){R=this}P[L](N,R,this);return this}});I.bind=I.on;I.unbind=I.off;K.extend(z,I);var E=z.Model=function(L,N){var O;var M=L||{};N||(N={});this.cid=K.uniqueId("c");this.attributes={};if(N.collection){this.collection=N.collection}if(N.parse){M=this.parse(M,N)||{}}if(O=K.result(this,"defaults")){M=K.defaults({},M,O)}this.set(M,N);this.changed={};this.initialize.apply(this,arguments)};K.extend(E.prototype,I,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(L){return K.clone(this.attributes)},sync:function(){return z.sync.apply(this,arguments)},get:function(L){return this.attributes[L]},escape:function(L){return K.escape(this.get(L))},has:function(L){return this.get(L)!=null},set:function(T,L,X){var R,U,V,S,Q,W,N,P;if(T==null){return this}if(typeof T==="object"){U=T;X=L}else{(U={})[T]=L}X||(X={});if(!this._validate(U,X)){return false}V=X.unset;Q=X.silent;S=[];W=this._changing;this._changing=true;if(!W){this._previousAttributes=K.clone(this.attributes);this.changed={}}P=this.attributes,N=this._previousAttributes;if(this.idAttribute in U){this.id=U[this.idAttribute]}for(R in U){L=U[R];if(!K.isEqual(P[R],L)){S.push(R)}if(!K.isEqual(N[R],L)){this.changed[R]=L}else{delete this.changed[R]}V?delete P[R]:P[R]=L}if(!Q){if(S.length){this._pending=true}for(var O=0,M=S.length;O<M;O++){this.trigger("change:"+S[O],this,P[S[O]],X)}}if(W){return this}if(!Q){while(this._pending){this._pending=false;this.trigger("change",this,X)}}this._pending=false;this._changing=false;return this},unset:function(L,M){return this.set(L,void 0,K.extend({},M,{unset:true}))},clear:function(M){var L={};for(var N in this.attributes){L[N]=void 0}return this.set(L,K.extend({},M,{unset:true}))},hasChanged:function(L){if(L==null){return !K.isEmpty(this.changed)}return K.has(this.changed,L)},changedAttributes:function(N){if(!N){return this.hasChanged()?K.clone(this.changed):false}var P,O=false;var M=this._changing?this._previousAttributes:this.attributes;for(var L in N){if(K.isEqual(M[L],(P=N[L]))){continue}(O||(O={}))[L]=P}return O},previous:function(L){if(L==null||!this._previousAttributes){return null}return this._previousAttributes[L]},previousAttributes:function(){return K.clone(this._previousAttributes)},fetch:function(M){M=M?K.clone(M):{};if(M.parse===void 0){M.parse=true}var L=this;var N=M.success;M.success=function(O){if(!L.set(L.parse(O,M),M)){return false}if(N){N(L,O,M)}L.trigger("sync",L,O,M)};G(this,M);return this.sync("read",this,M)},save:function(P,M,T){var Q,L,S,N=this.attributes;if(P==null||typeof P==="object"){Q=P;T=M}else{(Q={})[P]=M}T=K.extend({validate:true},T);if(Q&&!T.wait){if(!this.set(Q,T)){return false}}else{if(!this._validate(Q,T)){return false}}if(Q&&T.wait){this.attributes=K.extend({},N,Q)}if(T.parse===void 0){T.parse=true}var O=this;var R=T.success;T.success=function(V){O.attributes=N;var U=O.parse(V,T);if(T.wait){U=K.extend(Q||{},U)}if(K.isObject(U)&&!O.set(U,T)){return false}if(R){R(O,V,T)}O.trigger("sync",O,V,T)};G(this,T);L=this.isNew()?"create":(T.patch?"patch":"update");if(L==="patch"){T.attrs=Q}S=this.sync(L,this,T);if(Q&&T.wait){this.attributes=N}return S},destroy:function(M){M=M?K.clone(M):{};var L=this;var P=M.success;var N=function(){L.trigger("destroy",L,L.collection,M)};M.success=function(Q){if(M.wait||L.isNew()){N()}if(P){P(L,Q,M)}if(!L.isNew()){L.trigger("sync",L,Q,M)}};if(this.isNew()){M.success();return false}G(this,M);var O=this.sync("delete",this,M);if(!M.wait){N()}return O},url:function(){var L=K.result(this,"urlRoot")||K.result(this.collection,"url")||r();if(this.isNew()){return L}return L+(L.charAt(L.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(M,L){return M},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(L){return this._validate({},K.extend(L||{},{validate:true}))},_validate:function(N,M){if(!M.validate||!this.validate){return true}N=K.extend({},this.attributes,N);var L=this.validationError=this.validate(N,M)||null;if(!L){return true}this.trigger("invalid",this,L,K.extend(M||{},{validationError:L}));return false}});var a=["keys","values","pairs","invert","pick","omit"];K.each(a,function(L){E.prototype[L]=function(){var M=n.call(arguments);M.unshift(this.attributes);return K[L].apply(K,M)}});var c=z.Collection=function(M,L){L||(L={});if(L.model){this.model=L.model}if(L.comparator!==void 0){this.comparator=L.comparator}this._reset();this.initialize.apply(this,arguments);if(M){this.reset(M,K.extend({silent:true},L))}};var o={add:true,remove:true,merge:true};var J={add:true,merge:false,remove:false};K.extend(c.prototype,I,{model:E,initialize:function(){},toJSON:function(L){return this.map(function(M){return M.toJSON(L)})},sync:function(){return z.sync.apply(this,arguments)},add:function(M,L){return this.set(M,K.defaults(L||{},J))},remove:function(Q,O){Q=K.isArray(Q)?Q.slice():[Q];O||(O={});var P,L,N,M;for(P=0,L=Q.length;P<L;P++){M=this.get(Q[P]);if(!M){continue}delete this._byId[M.id];delete this._byId[M.cid];N=this.indexOf(M);this.models.splice(N,1);this.length--;if(!O.silent){O.index=N;M.trigger("remove",M,this,O)}this._removeReference(M)}return this},set:function(aa,M){M=K.defaults(M||{},o);if(M.parse){aa=this.parse(aa,M)}if(!K.isArray(aa)){aa=aa?[aa]:[]}var X,V,N,T,R,Z;var P=M.at;var L=this.comparator&&(P==null)&&M.sort!==false;var Y=K.isString(this.comparator)?this.comparator:null;var ab=[],U=[],S={};var Q=M.add,O=M.merge,ac=M.remove;var W=!L&&Q&&ac?[]:false;for(X=0,V=aa.length;X<V;X++){if(!(N=this._prepareModel(aa[X],M))){continue}if(R=this.get(N)){if(ac){S[R.cid]=true}if(O){R.set(N.attributes,M);if(L&&!Z&&R.hasChanged(Y)){Z=true}}}else{if(Q){ab.push(N);N.on("all",this._onModelEvent,this);this._byId[N.cid]=N;if(N.id!=null){this._byId[N.id]=N}}}if(W){W.push(R||N)}}if(ac){for(X=0,V=this.length;X<V;++X){if(!S[(N=this.models[X]).cid]){U.push(N)}}if(U.length){this.remove(U,M)}}if(ab.length||(W&&W.length)){if(L){Z=true}this.length+=ab.length;if(P!=null){t.apply(this.models,[P,0].concat(ab))}else{if(W){this.models.length=0}D.apply(this.models,W||ab)}}if(Z){this.sort({silent:true})}if(M.silent){return this}for(X=0,V=ab.length;X<V;X++){(N=ab[X]).trigger("add",N,this,M)}if(Z||(W&&W.length)){this.trigger("sort",this,M)}return this},reset:function(O,M){M||(M={});for(var N=0,L=this.models.length;N<L;N++){this._removeReference(this.models[N])}M.previousModels=this.models;this._reset();this.add(O,K.extend({silent:true},M));if(!M.silent){this.trigger("reset",this,M)}return this},push:function(M,L){M=this._prepareModel(M,L);this.add(M,K.extend({at:this.length},L));return M},pop:function(M){var L=this.at(this.length-1);this.remove(L,M);return L},unshift:function(M,L){M=this._prepareModel(M,L);this.add(M,K.extend({at:0},L));return M},shift:function(M){var L=this.at(0);this.remove(L,M);return L},slice:function(){return n.apply(this.models,arguments)},get:function(L){if(L==null){return void 0}return this._byId[L.id!=null?L.id:L.cid||L]},at:function(L){return this.models[L]},where:function(L,M){if(K.isEmpty(L)){return M?void 0:[]}return this[M?"find":"filter"](function(N){for(var O in L){if(L[O]!==N.get(O)){return false}}return true})},findWhere:function(L){return this.where(L,true)},sort:function(L){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}L||(L={});if(K.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(K.bind(this.comparator,this))}if(!L.silent){this.trigger("sort",this,L)}return this},sortedIndex:function(L,O,M){O||(O=this.comparator);var N=K.isFunction(O)?O:function(P){return P.get(O)};return K.sortedIndex(this.models,L,N,M)},pluck:function(L){return K.invoke(this.models,"get",L)},fetch:function(L){L=L?K.clone(L):{};if(L.parse===void 0){L.parse=true}var N=L.success;var M=this;L.success=function(O){var P=L.reset?"reset":"set";M[P](O,L);if(N){N(M,O,L)}M.trigger("sync",M,O,L)};G(this,L);return this.sync("read",this,L)},create:function(M,L){L=L?K.clone(L):{};if(!(M=this._prepareModel(M,L))){return false}if(!L.wait){this.add(M,L)}var O=this;var N=L.success;L.success=function(P){if(L.wait){O.add(M,L)}if(N){N(M,P,L)}};M.save(null,L);return M},parse:function(M,L){return M},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(N,M){if(N instanceof E){if(!N.collection){N.collection=this}return N}M||(M={});M.collection=this;var L=new this.model(N,M);if(!L._validate(N,M)){this.trigger("invalid",this,N,M);return false}return L},_removeReference:function(L){if(this===L.collection){delete L.collection}L.off("all",this._onModelEvent,this)},_onModelEvent:function(N,M,O,L){if((N==="add"||N==="remove")&&O!==this){return}if(N==="destroy"){this.remove(M,L)}if(M&&N==="change:"+M.idAttribute){delete this._byId[M.previous(M.idAttribute)];if(M.id!=null){this._byId[M.id]=M}}this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];K.each(y,function(L){c.prototype[L]=function(){var M=n.call(arguments);M.unshift(this.models);return K[L].apply(K,M)}});var k=["groupBy","countBy","sortBy"];K.each(k,function(L){c.prototype[L]=function(O,M){var N=K.isFunction(O)?O:function(P){return P.get(O)};return K[L](this.models,N,M)}});var F=z.View=function(L){this.cid=K.uniqueId("view");L||(L={});K.extend(this,K.pick(L,e));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var v=/^(\S+)\s*(.*)$/;var e=["model","collection","el","id","attributes","className","tagName","events"];K.extend(F.prototype,I,{tagName:"div",$:function(L){return this.$el.find(L)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(L,M){if(this.$el){this.undelegateEvents()}this.$el=L instanceof z.$?L:z.$(L);this.el=this.$el[0];if(M!==false){this.delegateEvents()}return this},delegateEvents:function(P){if(!(P||(P=K.result(this,"events")))){return this}this.undelegateEvents();for(var O in P){var Q=P[O];if(!K.isFunction(Q)){Q=this[P[O]]}if(!Q){continue}var N=O.match(v);var M=N[1],L=N[2];Q=K.bind(Q,this);M+=".delegateEvents"+this.cid;if(L===""){this.$el.on(M,Q)}else{this.$el.on(M,L,Q)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var L=K.extend({},K.result(this,"attributes"));if(this.id){L.id=K.result(this,"id")}if(this.className){L["class"]=K.result(this,"className")}var M=z.$("<"+K.result(this,"tagName")+">").attr(L);this.setElement(M,false)}else{this.setElement(K.result(this,"el"),false)}}});z.sync=function(R,M,L){var O=j[R];K.defaults(L||(L={}),{emulateHTTP:z.emulateHTTP,emulateJSON:z.emulateJSON});var Q={type:O,dataType:"json"};if(!L.url){Q.url=K.result(M,"url")||r()}if(L.data==null&&M&&(R==="create"||R==="update"||R==="patch")){Q.contentType="application/json";Q.data=JSON.stringify(L.attrs||M.toJSON(L))}if(L.emulateJSON){Q.contentType="application/x-www-form-urlencoded";Q.data=Q.data?{model:Q.data}:{}}if(L.emulateHTTP&&(O==="PUT"||O==="DELETE"||O==="PATCH")){Q.type="POST";if(L.emulateJSON){Q.data._method=O}var N=L.beforeSend;L.beforeSend=function(S){S.setRequestHeader("X-HTTP-Method-Override",O);if(N){return N.apply(this,arguments)}}}if(Q.type!=="GET"&&!L.emulateJSON){Q.processData=false}if(Q.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){Q.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var P=L.xhr=z.ajax(K.extend(Q,L));M.trigger("request",M,P,L);return P};var j={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};z.ajax=function(){return z.$.ajax.apply(z.$,arguments)};var p=z.Router=function(L){L||(L={});if(L.routes){this.routes=L.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var q=/\((.*?)\)/g;var s=/(\(\?)?:\w+/g;var d=/\*\w+/g;var h=/[\-{}\[\]+?.,\\\^$|#\s]/g;K.extend(p.prototype,I,{initialize:function(){},route:function(M,N,O){if(!K.isRegExp(M)){M=this._routeToRegExp(M)}if(K.isFunction(N)){O=N;N=""}if(!O){O=this[N]}var L=this;z.history.route(M,function(Q){var P=L._extractParameters(M,Q);O&&O.apply(L,P);L.trigger.apply(L,["route:"+N].concat(P));L.trigger("route",N,P);z.history.trigger("route",L,N,P)});return this},navigate:function(M,L){z.history.navigate(M,L);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=K.result(this,"routes");var M,L=K.keys(this.routes);while((M=L.pop())!=null){this.route(M,this.routes[M])}},_routeToRegExp:function(L){L=L.replace(h,"\\$&").replace(q,"(?:$1)?").replace(s,function(N,M){return M?N:"([^/]+)"}).replace(d,"(.*?)");return new RegExp("^"+L+"$")},_extractParameters:function(L,M){var N=L.exec(M).slice(1);return K.map(N,function(O){return O?decodeURIComponent(O):null})}});var i=z.History=function(){this.handlers=[];K.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var A=/^[#\/]|\s+$/g;var f=/^\/+|\/+$/g;var H=/msie [\w.]+/;var m=/\/$/;i.started=false;K.extend(i.prototype,I,{interval:50,getHash:function(M){var L=(M||this).location.href.match(/#(.*)$/);return L?L[1]:""},getFragment:function(N,M){if(N==null){if(this._hasPushState||!this._wantsHashChange||M){N=this.location.pathname;var L=this.root.replace(m,"");if(!N.indexOf(L)){N=N.substr(L.length)}}else{N=this.getHash()}}return N.replace(A,"")},start:function(N){if(i.started){throw new Error("Backbone.history has already been started")}i.started=true;this.options=K.extend({},{root:"/"},this.options,N);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var M=this.getFragment();var L=document.documentMode;var P=(H.exec(navigator.userAgent.toLowerCase())&&(!L||L<=7));this.root=("/"+this.root+"/").replace(f,"/");if(P&&this._wantsHashChange){this.iframe=z.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(M)}if(this._hasPushState){z.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!P){z.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=M;var Q=this.location;var O=Q.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!O){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&O&&Q.hash){this.fragment=this.getHash().replace(A,"");this.history.replaceState({},document.title,this.root+this.fragment+Q.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){z.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);i.started=false},route:function(L,M){this.handlers.unshift({route:L,callback:M})},checkUrl:function(M){var L=this.getFragment();if(L===this.fragment&&this.iframe){L=this.getFragment(this.getHash(this.iframe))}if(L===this.fragment){return false}if(this.iframe){this.navigate(L)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(N){var M=this.fragment=this.getFragment(N);var L=K.any(this.handlers,function(O){if(O.route.test(M)){O.callback(M);return true}});return L},navigate:function(N,M){if(!i.started){return false}if(!M||M===true){M={trigger:M}}N=this.getFragment(N||"");if(this.fragment===N){return}this.fragment=N;var L=this.root+N;if(this._hasPushState){this.history[M.replace?"replaceState":"pushState"]({},document.title,L)}else{if(this._wantsHashChange){this._updateHash(this.location,N,M.replace);if(this.iframe&&(N!==this.getFragment(this.getHash(this.iframe)))){if(!M.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,N,M.replace)}}else{return this.location.assign(L)}}if(M.trigger){return this.loadUrl(N)}},_updateHash:function(L,N,O){if(O){var M=L.href.replace(/(javascript:|#).*$/,"");L.replace(M+"#"+N)}else{L.hash="#"+N}}});z.history=new i;var l=function(L,N){var M=this;var P;if(L&&K.has(L,"constructor")){P=L.constructor}else{P=function(){return M.apply(this,arguments)}}K.extend(P,M,N);var O=function(){this.constructor=P};O.prototype=M.prototype;P.prototype=new O;if(L){K.extend(P.prototype,L)}P.__super__=M.prototype;return P};E.extend=c.extend=p.extend=F.extend=i.extend=l;var r=function(){throw new Error('A "url" property or function must be specified')};var G=function(N,M){var L=M.error;M.error=function(O){if(L){L(N,O,M)}N.trigger("error",N,O,M)}}}).call(this);